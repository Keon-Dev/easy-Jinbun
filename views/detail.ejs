<%- include('partials/header') %>
<%- include('partials/navbar') %>

<div class="container">
  <div class="row">
    <div class="col-lg-8">
      <h1><%= course.title %></h1>
      <h4 class="text-muted mb-3"><%= course.professor %></h4>
      
      <div class="card mb-4">
        <div class="card-body">
          <h5 class="card-title">授業情報</h5>
          <p><strong>カテゴリ:</strong> <%= course.category %></p>
          <p><strong>学期:</strong> <%= course.semester %></p>
          <p><strong>単位数:</strong> <%= course.credits %></p>
          <p><strong>説明:</strong> <%= course.description || '説明なし' %></p>
          
          <h6 class="mt-3">成績評価割合</h6>
          <ul class="list-unstyled">
            <li>出席: <%= course.grading.attendance %>%</li>
            <li>レポート: <%= course.grading.report %>%</li>
            <li>試験: <%= course.grading.exam %>%</li>
            <li>発表: <%= course.grading.presentation %>%</li>
            <li>その他: <%= course.grading.other %>%</li>
          </ul>
          
          <a href="/courses/<%= course._id %>/edit" class="btn btn-warning">編集</a>
        </div>
      </div>
      
      <h3>レビュー (<%= reviews.length %>件)</h3>
      
      <% reviews.forEach(review => { %>
        <div class="card mb-3">
          <div class="card-body">
            <p><strong>楽単度:</strong> <%= review.ease_rating %> / 5 | <strong>面白さ:</strong> <%= review.fun_rating %> / 5</p>
            <p><%= review.comment %></p>
            <small class="text-muted">投稿日: <%= new Date(review.created_at).toLocaleDateString('ja-JP') %></small>
          </div>
        </div>
      <% }) %>
      
      <div class="card mt-4">
        <div class="card-body">
          <h5>レビューを投稿</h5>
          <form method="POST" action="/courses/<%= course._id %>/reviews" id="reviewForm">
            <input type="hidden" name="user_uuid" id="userUuidInput">
            
            <div class="mb-3">
              <label class="form-label">楽単度 (1-5)</label>
              <select name="ease_rating" class="form-select" required>
                <option value="">選択してください</option>
                <option value="1">1 - 非常に難しい</option>
                <option value="2">2 - やや難しい</option>
                <option value="3">3 - 普通</option>
                <option value="4">4 - やや楽</option>
                <option value="5">5 - 非常に楽</option>
              </select>
            </div>
            
            <div class="mb-3">
              <label class="form-label">面白さ (1-5)</label>
              <select name="fun_rating" class="form-select" required>
                <option value="">選択してください</option>
                <option value="1">1 - 全く面白くない</option>
                <option value="2">2 - あまり面白くない</option>
                <option value="3">3 - 普通</option>
                <option value="4">4 - やや面白い</option>
                <option value="5">5 - 非常に面白い</option>
              </select>
            </div>
            
            <div class="mb-3">
              <label class="form-label">コメント</label>
              <textarea name="comment" class="form-control" rows="4"></textarea>
            </div>
            
            <button type="submit" class="btn btn-primary">投稿</button>
          </form>
        </div>
      </div>
    </div>
    
    <div class="col-lg-4">
      <div class="card">
        <div class="card-body">
          <h5>統計情報</h5>
          <p><strong>平均楽単度:</strong> <%= course.stats.avg_ease.toFixed(1) %> / 5</p>
          <p><strong>平均面白さ:</strong> <%= course.stats.avg_fun.toFixed(1) %> / 5</p>
          <p><strong>レビュー数:</strong> <%= course.stats.review_count %></p>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="/js/main.js"></script>
</body>
</html>